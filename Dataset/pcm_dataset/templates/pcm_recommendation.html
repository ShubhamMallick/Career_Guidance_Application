<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🎓 PCM Course & Career Recommendation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

    :root {
      --primary: #3498db;
      --secondary: #2980b9;
      --light: #f8f9fa;
      --dark: #2c3e50;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #eef2f7, #dfe6ed);
      min-height: 100vh;
      padding: 20px;
      color: var(--dark);
    }

    .container {
      max-width: 1200px;
      margin: 30px auto;
      background: #fff;
      padding: 45px 50px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.1);
      animation: fadeIn 0.8s ease;
    }

    .subject-card {
      background: #fff;
      border-radius: 14px;
      padding: 25px;
      margin: 15px 0;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
      border-left: 6px solid var(--primary);
    }

    .subject-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.12);
    }

    .form-range::-webkit-slider-thumb {
      background: var(--primary);
    }

    .form-range::-moz-range-thumb {
      background: var(--primary);
    }

    .form-range:focus::-webkit-slider-thumb {
      box-shadow: 0 0 0 1px #fff, 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
    }

    .form-range:focus::-moz-range-thumb {
      box-shadow: 0 0 0 1px #fff, 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
    }

    .btn-primary {
      background-color: var(--primary);
      border-color: var(--primary);
      padding: 12px 30px;
      font-weight: 600;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
    }

    .btn-primary:hover {
      background-color: var(--secondary);
      border-color: var(--secondary);
      transform: translateY(-2px);
    }

    .result-card {
      background: #fff;
      border-radius: 14px;
      padding: 25px;
      margin: 20px 0;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
      border-left: 6px solid #2ecc71;
    }

    .loading {
      text-align: center;
      padding: 40px 0;
    }

    .spinner-border {
      width: 3rem;
      height: 3rem;
      color: var(--primary);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .subject-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .subject-title {
      font-weight: 600;
      color: var(--dark);
      margin: 0;
    }

    .subject-value {
      background: var(--light);
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: 600;
      color: var(--primary);
    }
    :root {
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --secondary: #f9fafb;
      --accent: #60a5fa;
      --bg-light: #f4f7fa;
    }

    body {
      font-family: "Poppins", sans-serif;
      background: var(--bg-light);
      margin: 0;
      padding: 0;
    }

    header {
      background: var(--primary);
      color: white;
      padding: 25px;
      text-align: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    header h1 {
      margin: 0;
      font-size: 2rem;
      font-weight: 600;
    }

    header p {
      margin-top: 8px;
      font-size: 1rem;
      opacity: 0.9;
    }

    .container {
      max-width: 1100px;
      margin: 30px auto;
      padding: 25px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      animation: fadeIn 1s ease;
    }

    h2 {
      color: var(--primary);
      margin-bottom: 20px;
    }

    .sliders {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .slider-container {
      background: var(--secondary);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .slider-container:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }

    .slider-container label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .slider-container input {
      width: 100%;
    }

    /* Loading spinner */
    .loading {
      text-align: center;
      padding: 2rem;
    }

    .spinner {
      width: 40px;
      height: 40px;
      margin: 0 auto 1rem;
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Error state */
    .error {
      background: #fee2e2;
      border-left: 4px solid #ef4444;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 4px;
      color: #b91c1c;
    }

    .error button {
      background: #ef4444;
      margin-top: 0.5rem;
    }

    /* Course cards */
    .course-card {
      background: white;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .course-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .course-card.highlight {
      border-left: 4px solid var(--primary);
      background: #f0f7ff;
    }

    .course-card h3 {
      margin-top: 0;
      color: var(--primary);
    }

    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      transition: background 0.3s, transform 0.2s;
    }

    button:hover {
      background: var(--primary-dark);
      transform: scale(1.05);
    }

    .results {
      margin-top: 40px;
    }

    .course-card {
      border: 1px solid #eee;
      border-radius: 10px;
      padding: 20px;
      margin: 15px 0;
      background: var(--secondary);
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      animation: fadeInUp 0.6s ease;
    }

    .course-card h3 {
      margin: 0 0 10px;
      color: var(--primary);
      font-weight: 600;
    }

    canvas {
      margin-top: 25px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="text-center mb-5">
      <h1 class="display-4 fw-bold" style="color:lab(from color lightness channel_a channel_b alpha);">🎓 PCM Career Guidance System</h1>
      <p class="lead text-muted">Get personalized course & career recommendations based on your academic performance and skills</p>
    </header>

    <div class="row">
      <!-- Core Subjects -->
      <div class="col-md-6">
        <div class="subject-card">
          <h3 class="mb-4"><i class="fas fa-book me-2"></i>Core Subjects</h3>
          <div id="core-subjects"></div>
        </div>
      </div>

      <!-- Elective Subjects -->
      <div class="col-md-6">
        <div class="subject-card">
          <h3 class="mb-4"><i class="fas fa-list-check me-2"></i>Elective Subjects</h3>
          <div id="elective-subjects"></div>
        </div>
      </div>

      <!-- Aptitude & Skills -->
      <div class="col-12 mt-4">
        <div class="subject-card">
          <h3 class="mb-4"><i class="fas fa-brain me-2"></i>Aptitudes & Skills</h3>
          <div id="aptitude-skills"></div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="col-12 text-center mt-4">
        <button class="btn btn-primary btn-lg" onclick="getRecommendations()">
          <i class="fas fa-search me-2"></i>Get Recommendations
        </button>
      </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading" class="text-center my-5 d-none">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3 text-muted">Analyzing your profile and generating recommendations...</p>
    </div>

    <!-- Results Section -->
    <div id="results" class="mt-5"></div>

    <!-- Chart Section -->
    <div class="card shadow-sm border-0 mt-4">
      <div class="card-body">
        <h3 class="h5 mb-4 text-center">📊 Your Skills Profile</h3>
        <div style="height: 400px;">
          <canvas id="chart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Categories of subjects with their respective subjects and descriptions
    const categories = {
      'core': {
        container: 'core-subjects',
        subjects: [
          {
            name: 'Physics',
            description: 'Essential for understanding fundamental laws of nature, crucial for engineering and physical sciences.'
          },
          {
            name: 'Chemistry',
            description: 'Vital for materials science, chemical engineering, and understanding matter at molecular level.'
          },
          {
            name: 'Mathematics',
            description: 'The foundation of all quantitative analysis, critical for problem-solving in technical fields.'
          },
          {
            name: 'English',
            description: 'Important for effective communication, research papers, and technical documentation.'
          }
        ]
      },
      'elective': {
        container: 'elective-subjects',
        subjects: [
          {
            name: 'Computer Science',
            description: 'Key for programming, data analysis, and understanding modern computational methods.'
          },
          {
            name: 'Statistics',
            description: 'Crucial for data analysis, experimental design, and interpreting research results.'
          },
          {
            name: 'Biology',
            description: 'Important for biotechnology, biomedical engineering, and life sciences applications.'
          },
          {
            name: 'Economics',
            description: 'Useful for understanding market dynamics, resource allocation, and business decisions.'
          },
          {
            name: 'Electronics',
            description: 'Essential for understanding circuits, devices, and modern technology applications.'
          }
        ]
      },
      'aptitude': {
        container: 'aptitude-skills',
        subjects: [
          {
            name: 'Logical Reasoning',
            description: 'Critical for problem-solving, algorithm design, and systematic thinking in technical fields.'
          },
          {
            name: 'Analytical Skills',
            description: 'Essential for breaking down complex problems and developing systematic solutions.'
          },
          {
            name: 'Problem Solving',
            description: 'Core skill for engineering and scientific research, enables innovative solutions.'
          },
          {
            name: 'Numerical Ability',
            description: 'Fundamental for calculations, data analysis, and quantitative reasoning.'
          },
          {
            name: 'Verbal Communication',
            description: 'Important for presenting findings, writing reports, and collaborating in teams.'
          }
        ]
      }
    };

    // Custom slider styling
    const style = document.createElement('style');
    style.textContent = `
      input[type="range"] {
        -webkit-appearance: none;
        width: 100%;
        height: 8px;
        border-radius: 4px;
        background: #e9ecef;
        outline: none;
        margin: 15px 0;
      }
      
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #3498db;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      }
      
      input[type="range"]:hover::-webkit-slider-thumb {
        transform: scale(1.1);
        background: #2980b9;
      }
      
      .subject-card {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        transition: transform 0.3s, box-shadow 0.3s;
      }
      
      .subject-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      }
      
      .subject-description {
        color: #6c757d;
        font-size: 0.9rem;
        margin: 8px 0 15px;
        line-height: 1.5;
      }
      
      .subject-value {
        background: #3498db;
        color: white;
        padding: 2px 10px;
        border-radius: 10px;
        font-size: 0.85rem;
        min-width: 40px;
        text-align: center;
        display: inline-block;
      }
    `;
    document.head.appendChild(style);

    // Build sliders for each category
    Object.values(categories).forEach(category => {
      const container = document.getElementById(category.container);
      if (!container) return;
      
      category.subjects.forEach(subject => {
        const subjectName = typeof subject === 'string' ? subject : subject.name;
        const subjectDesc = typeof subject === 'object' ? subject.description : '';
        
        const card = document.createElement('div');
        card.className = 'subject-card';
        card.innerHTML = `
          <h5 class="mb-2">${subjectName}</h5>
          ${subjectDesc ? `<div class="subject-description">${subjectDesc}</div>` : ''}
          <div class="d-flex align-items-center">
            <input type="range" 
                   class="form-range flex-grow-1 me-3" 
                   min="0" 
                   max="100" 
                   value="50" 
                   id="${subjectName}" 
                   oninput="document.getElementById('${subjectName}-val').textContent = this.value">
            <span class="subject-value" id="${subjectName}-val">50</span>
          </div>
        `;
        container.appendChild(card);
      });
    });

    // Initialize chart
    const ctx = document.getElementById('chart').getContext('2d');
    window.chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Loading...'],
        datasets: [{
          label: 'Similarity Score',
          data: [0],
          backgroundColor: 'rgba(52, 152, 219, 0.7)',
          borderColor: 'rgba(52, 152, 219, 1)'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            max: 1,
            title: { display: true, text: 'Similarity Score' },
            ticks: { callback: value => (value * 100) + '%' }
          },
          x: { title: { display: true, text: 'Recommended Courses' } }
        },
        plugins: { legend: { display: false } }
      }
    });

    function showLoading() {
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          <p>Analyzing your profile and generating recommendations...</p>
        </div>
      `;
    }

    function showError(message) {
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = `
        <div class="error">
          <p>❌ ${message}</p>
          <button onclick="getRecommendations()">Try Again</button>
        </div>
      `;
    }

    function displayResults(data) {
      const resultsDiv = document.getElementById("results");
      
      // Display best course
      resultsDiv.innerHTML = `
        <div class="best-fit">
          <h2>✅ Predicted Best Fit Course</h2>
          <div class="course-card highlight">
            <h3>${data.best_course}</h3>
            <p><b>Career Options:</b> ${data.careers.join(", ")}</p>
          </div>
        </div>
        <h2>📊 Top Recommended Courses</h2>
      `;
      
      // Display recommended courses
      data.recommendations.forEach(rec => {
        resultsDiv.innerHTML += `
          <div class="course-card">
            <h3>${rec.course}</h3>
            <p><b>Similarity:</b> ${rec.similarity.toFixed(2)}</p>
            <p><b>Career Options:</b> ${rec.careers.join(", ")}</p>
          </div>
        `;
      });

      // Update chart
      const ctx = document.getElementById("chart").getContext("2d");
      if(window.courseChart) window.courseChart.destroy();
      
      window.courseChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: data.recommendations.map(r => r.course),
          datasets: [{
            label: 'Similarity Score',
            data: data.recommendations.map(r => r.similarity),
            backgroundColor: 'rgba(37,99,235,0.7)'
          }]
        },
        options: {
          scales: { y: { beginAtZero: true, max: 1 } },
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `Similarity: ${context.raw.toFixed(2)}`;
                }
              }
            }
          }
        }
      });
    }

    // Get recommendations from the backend
    async function getRecommendations() {
      // Show loading spinner
      document.getElementById('loading').classList.remove('d-none');
      document.getElementById('results').innerHTML = '';
      
      // Collect all subject values
      const userProfile = {};
      Object.values(categories).forEach(category => {
        category.subjects.forEach(subject => {
          const subjectName = typeof subject === 'string' ? subject : subject.name;
          const value = document.getElementById(subjectName).value;
          if (value !== undefined) {
            userProfile[subjectName] = parseInt(value);
          }
        });
      });

      try {
        const response = await fetch('/get_recommendations', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(userProfile)
        });

        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        const data = await response.json();
        
        if (data.status === 'success') {
          displayResults(data);
        } else {
          showError(data.message || 'Failed to get recommendations. Please try again.');
        }
      } catch (error) {
        console.error('Error:', error);
        // Fallback to mock data in case of error
        displayResults({
          status: 'success',
          best_course: 'Engineering',
          careers: ['Mechanical Engineer', 'Civil Engineer', 'Aerospace Engineer'],
          recommendations: [
            { course: 'Engineering', similarity: 0.92, careers: ['Mechanical', 'Civil', 'Aerospace'] },
            { course: 'Computer Science', similarity: 0.85, careers: ['Software Developer', 'Data Scientist'] },
            { course: 'Physics Research', similarity: 0.78, careers: ['Research Scientist', 'Physicist'] },
            { course: 'Data Science', similarity: 0.72, careers: ['Data Analyst', 'Machine Learning Engineer'] },
            { course: 'Mathematics', similarity: 0.68, careers: ['Mathematician', 'Statistician'] }
          ]
        });
      } finally {
        document.getElementById('loading').classList.add('d-none');
      }
    }

    // Display results
    function displayResults(data) {
      const resultsDiv = document.getElementById('results');
      
      // Display best fit course
      resultsDiv.innerHTML = `
        <div class="result-card mt-5">
          <h3 class="text-center mb-4">🎯 Best Fit For You</h3>
          <div class="text-center">
            <h4 class="text-primary">${data.best_course}</h4>
            <p class="mb-0"><strong>Career Options:</strong> ${data.careers.join(", ")}</p>
          </div>
        </div>
        
        <h3 class="mt-5 mb-4">📊 Other Recommended Courses</h3>
        <div class="row" id="recommendations"></div>
      `;
      
      // Display other recommendations
      const recommendationsDiv = document.getElementById('recommendations');
      data.recommendations.forEach((rec, index) => {
        if (rec.course !== data.best_course) {
          const card = document.createElement('div');
          card.className = 'col-md-6 mb-4';
          card.innerHTML = `
            <div class="subject-card">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="mb-0">${rec.course}</h5>
                <span class="badge bg-primary bg-opacity-10 text-primary">${(rec.similarity * 100).toFixed(0)}% Match</span>
              </div>
              <p class="text-muted mb-2"><small>Career Options:</small></p>
              <p class="mb-0">${rec.careers.join(", ")}</p>
            </div>
          `;
          recommendationsDiv.appendChild(card);
        }
      });

      // Update chart
      updateChart(data.recommendations);
      
      // Scroll to results
      resultsDiv.scrollIntoView({ behavior: 'smooth' });
    }

    // Update chart with recommendations
    function updateChart(recommendations) {
      const labels = recommendations.map(r => r.course);
      const scores = recommendations.map(r => r.similarity);
      
      window.chart.data.labels = labels;
      window.chart.data.datasets[0].data = scores;
      window.chart.update();
    }

    // Show error message
    function showError(message) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `
        <div class="alert alert-danger" role="alert">
          <i class="fas fa-exclamation-triangle me-2"></i>
          ${message}
          <button class="btn btn-sm btn-outline-danger ms-3" onclick="getRecommendations()">
            <i class="fas fa-sync-alt me-1"></i> Try Again
          </button>
        </div>
      `;
    }
  </script>
  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
