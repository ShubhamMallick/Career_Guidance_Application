<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸŽ“ Commerce Course & Career Recommendation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Floating animation */
    @keyframes float {
      0% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
      100% { transform: translateY(0px) rotate(0deg); }
    }
    
    .floating-element {
      position: absolute;
      opacity: 0.6;
      z-index: -1;
      animation: float 6s ease-in-out infinite;
    }
    
    .floating-element:nth-child(1) {
      left: 10%;
      top: 20%;
      font-size: 3rem;
      animation-delay: 0s;
      color: #4361ee;
    }
    
    .floating-element:nth-child(2) {
      right: 15%;
      top: 30%;
      font-size: 2.5rem;
      animation-delay: 1s;
      color: #4cc9f0;
    }
    
    .floating-element:nth-child(3) {
      left: 20%;
      bottom: 25%;
      font-size: 3.5rem;
      animation-delay: 2s;
      color: #3f37c9;
    }
    
    .floating-element:nth-child(4) {
      right: 10%;
      bottom: 20%;
      font-size: 2rem;
      animation-delay: 3s;
      color: #4895ef;
    }
    
    body {
      position: relative;
      overflow-x: hidden;
      min-height: 100vh;
    }
    
    .content-wrapper {
      position: relative;
      z-index: 1;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(5px);
    }
  </style>
  <script>
    // Initialize chart variable in global scope
    window.commerceChart = null;
    
    // Wait for the DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize any default chart if needed
      const chartElement = document.getElementById('chart');
      if (chartElement) {
        // Initialize an empty chart
        const ctx = chartElement.getContext('2d');
        window.commerceChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['Loading...'],
            datasets: [{
              label: 'Similarity Score',
              data: [0],
              backgroundColor: 'rgba(52, 152, 219, 0.7)',
              borderColor: 'rgba(52, 152, 219, 1)'
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                max: 1,
                title: { display: true, text: 'Similarity Score' },
                ticks: { callback: value => (value * 100) + '%' }
              },
              x: { title: { display: true, text: 'Recommended Courses' } }
            },
            plugins: { legend: { display: false } }
          }
        });
      }
    });
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

    :root {
      --primary: #3498db;
      --secondary: #2980b9;
      --light: #f8f9fa;
      --dark: #2c3e50;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #eef2f7, #dfe6ed);
      min-height: 100vh;
      padding: 20px;
      color: var(--dark);
    }

    .container {
      max-width: 1400px;
      margin: 30px auto;
      background: #fff;
      padding: 45px 50px;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.1);
      animation: fadeIn 0.8s ease;
    }
    
    .subject-card {
      background: #fff;
      border-radius: 14px;
      padding: 30px;
      margin: 20px 0;
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
      transition: all 0.3s ease;
      border-left: 6px solid #3498db;
      min-height: 280px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .subject-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.12);
    }
    
    .subject-description {
      font-size: 0.95em;
      line-height: 1.6;
      .slider-container {
        margin-top: 25px;
        padding: 20px;
        background: #f5f9ff;
        border-radius: 10px;
        border: 1px solid #e0ecff;
      }
      border-left: 4px solid #b8daff;
      flex-grow: 1;
    }
    
    .subject-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    
    .slider-label {
      font-weight: 500;
      color: #2c3e50;
      margin-bottom: 5px;
      display: block;
    }
    
    .form-range::-webkit-slider-thumb {
      background: #3498db;
    }
    
    .form-range::-moz-range-thumb {
      background: #3498db;
    }
    
    .form-range::-ms-thumb {
      background: #3498db;
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }
    
    .spinner-border {
      width: 3rem;
      height: 3rem;
    }

    h1 {
      text-align: center;
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 25px;
      animation: fadeInDown 0.8s ease;
    }

    h3 {
      margin-bottom: 20px;
      color: var(--secondary);
      font-weight: 600;
    }

    .slider-group {
      margin: 18px 0;
      animation: fadeIn 0.8s ease;
    }

    .slider-group label {
      display: block;
      font-weight: 500;
      margin-bottom: 6px;
      color: #495057;
    }

    .form-range {
      accent-color: var(--primary);
    }

    .btn-primary {
      background-color: var(--primary);
      border: none;
      padding: 12px 25px;
      font-weight: 500;
      transition: all 0.3s ease;
      border-radius: 10px;
    }

    .btn-primary:hover {
      background-color: var(--secondary);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(52,152,219,0.3);
    }

    .results {
      margin-top: 30px;
      animation: fadeIn 0.8s ease;
    }

    .course-card {
      background: var(--light);
      padding: 18px;
      border-radius: 12px;
      margin-bottom: 18px;
      border-left: 4px solid var(--primary);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .course-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    }

    .progress {
      height: 12px;
      border-radius: 6px;
      margin: 30px 0 35px 0;
      background-color: #e3f2fd;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }

    .progress-bar {
      background-color: var(--primary);
      transition: width 0.6s ease;
    }

    .subject-column {
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 25px 20px;
      background: #f8f9fa;
      border-radius: 16px;
      margin: 15px 0;
      box-shadow: 0 4px 15px rgba(0,0,0,0.06);
      min-height: 1200px;
    }
    
    .subject-column h5 {
      padding: 15px 20px;
      background: #e7f1ff;
      border-radius: 10px;
      margin: 0 0 25px 0;
      font-weight: 700;
      font-size: 1.3em;
      color: #2c3e50;
      text-align: center;
      border-bottom: 3px solid #d0e3ff;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-15px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <!-- Floating animation elements -->
  <div class="floating-element">
    <i class="fas fa-chart-line"></i>
  </div>
  <div class="floating-element">
    <i class="fas fa-calculator"></i>
  </div>
  <div class="floating-element">
    <i class="fas fa-business-time"></i>
  </div>
  <div class="floating-element">
    <i class="fas fa-coins"></i>
  </div>
  
  <div class="content-wrapper">

  <div class="container" id="app" data-categories='{{ categories|tojson|safe }}'>
    <div class="header-section mb-5">
      <h1 class="text-center mb-3">Commerce Course & Career Recommendation</h1>
      <p class="lead text-center text-muted mb-4">Rate your subjects and skills (0-100) to discover your ideal career path in Commerce.</p>
      <div class="d-flex justify-content-center">
        <div class="col-lg-8">
          <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            Rate each subject based on your interest and proficiency. The more accurate your ratings, better the career recommendations.
          </div>
        </div>
      </div>
    </div>
    
    <!-- Progress Bar -->
    <div class="progress mb-4" style="height: 10px; border-radius: 5px;">
      <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%; transition: width 0.6s ease;"></div>
    </div>
    
    <!-- Main Form -->
    <div id="step1">
      <div class="row g-4" id="subjectInputs">
        <!-- Columns will be dynamically generated -->
        {% for category_id, category in categories.items() %}
        <div class="col-md-6 col-lg-4">
          <div class="subject-column h-100">
            <h5 class="text-center mb-4"><i class="fas fa-{{ category.icon }} me-2"></i>{{ category.title }}</h5>
            <div class="subject-column-content">
              {% for subject in category.subjects %}
              <div class="subject-card">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <h5 class="mb-0 fw-bold">{{ subject }}</h5>
                  <span class="badge bg-primary">
                    {{ subject[:12] }}{% if subject|length > 12 %}...{% endif %}
                  </span>
                </div>
                
                {% if subject == 'Accountancy' %}
                <div class="subject-description">
                  Essential for understanding financial statements, bookkeeping, and business finances. Crucial for careers in finance, auditing, and business management.
                </div>
                {% elif subject == 'Business Studies' %}
                <div class="subject-description">
                  Provides foundational knowledge of business operations, management principles, and entrepreneurship. Key for future business leaders and managers.
                </div>
                {% elif subject == 'Economics' %}
                <div class="subject-description">
                  Develops understanding of market forces, economic theories, and policy-making. Important for careers in finance, policy, and research.
                </div>
                {% elif subject == 'Mathematics' %}
                <div class="subject-description">
                  Builds analytical and problem-solving skills. Essential for data analysis, economics, and higher studies in commerce and finance.
                </div>
                {% elif subject == 'English' %}
                <div class="subject-description">
                  Enhances communication, critical thinking, and analytical writing skills. Vital for business communication and professional success.
                </div>
                {% elif subject == 'Hindi' %}
                <div class="subject-description">
                  Improves communication in a widely spoken Indian language, beneficial for business interactions in the Indian market.
                </div>
                {% elif subject == 'Statistics' %}
                <div class="subject-description">
                  Essential for data analysis, market research, and business forecasting. Valuable for careers in analytics and research.
                </div>
                {% elif subject == 'Computer Science' %}
                <div class="subject-description">
                  Provides digital literacy and technical skills crucial for modern business operations and e-commerce.
                </div>
                {% elif subject == 'Psychology' %}
                <div class="subject-description">
                  Enhances understanding of consumer behavior and human resources management.
                </div>
                {% elif subject == 'Sociology' %}
                <div class="subject-description">
                  Provides insights into social structures and consumer behavior patterns.
                </div>
                {% elif subject == 'Logical Reasoning' %}
                <div class="subject-description">
                  Develops problem-solving and decision-making abilities crucial for business strategy and analysis.
                </div>
                {% elif subject == 'Numerical Aptitude' %}
                <div class="subject-description">
                  Essential for financial calculations, data analysis, and quantitative business decisions.
                </div>
                {% elif subject == 'Critical Thinking' %}
                <div class="subject-description">
                  Enhances analytical skills and the ability to evaluate business scenarios objectively.
                </div>
                {% elif subject == 'Empathy' %}
                <div class="subject-description">
                  Important for customer relations, team management, and leadership roles.
                </div>
                {% elif subject == 'Memory' %}
                <div class="subject-description">
                  Helps in retaining business knowledge, client information, and market trends.
                </div>
                {% elif subject == 'Communication' %}
                <div class="subject-description">
                  Essential for effective business interactions, presentations, and negotiations.
                </div>
                {% elif subject == 'Creativity' %}
                <div class="subject-description">
                  Drives innovation, problem-solving, and strategic thinking in business.
                </div>
                {% endif %}
                
                <p class="small text-muted mt-3 mb-2">Rate your proficiency (0-100)</p>
                <div class="d-flex align-items-center">
                  <input type="range" min="0" max="100" value="50" 
                         class="form-range flex-grow-1 me-3" 
                         id="{{ subject }}" 
                         name="{{ subject }}"
                         oninput="document.getElementById('{{ subject }}-value').textContent = this.value + '%'"
                         style="--bs-thumb-bg: #3498db">
                  <span class="badge bg-primary" style="min-width: 50px;" id="{{ subject }}-value">50%</span>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      
      <div class="text-center mt-5">
        <button class="btn btn-primary btn-lg px-5" id="recommendBtn" onclick="getRecommendations()">
          <i class="fas fa-chart-line me-2"></i>Get Recommendations
        </button>
      </div>
    </div>
    
    <!-- Loading Indicator -->
    <div id="loading" class="loading">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">Analyzing your profile and finding the best matches...</p>
    </div>
    
    <!-- Results Section -->
    <div id="results" class="mt-5" style="display: none;">
      <h2 class="text-center mb-4">Your Career Recommendations</h2>
      <div id="recommendations" class="row g-4"></div>
      
      <div class="mt-5">
        <h3 class="text-center mb-4">Recommendation Analysis</h3>
        <div class="chart-container" style="position: relative; height:400px;">
          <canvas id="chart"></canvas>
        </div>
      </div>
      
      <div class="text-center mt-5">
        <button class="btn btn-outline-primary" onclick="resetForm()">
          <i class="fas fa-redo me-2"></i>Start Over
        </button>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let features = [];
    let chart = null;
    
    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      // Extract features from the data attribute
      const appElement = document.getElementById('app');
      if (appElement) {
        try {
          const categories = JSON.parse(appElement.dataset.categories);
          features = [];
          for (const [_, category] of Object.entries(categories)) {
            if (category && category.subjects) {
              features = features.concat(category.subjects);
            }
          }
        } catch (error) {
          console.error('Error parsing categories:', error);
          features = [];
        }
      }
      updateProgress(33);
      
      // Add event listeners to all sliders
      document.querySelectorAll('.form-range').forEach(slider => {
        const valueSpan = document.getElementById(`${slider.id}-value`);
        slider.addEventListener('input', function() {
          if (valueSpan) {
            valueSpan.textContent = this.value + '%';
          }
        });
      });
    });
    
    // Get recommendations from the backend
    async function getRecommendations() {
      try {
        // Show loading state
        document.getElementById('step1').style.display = 'none';
        document.getElementById('loading').style.display = 'block';
        document.getElementById('results').style.display = 'none';
        
        // Prepare the data
        const userInput = {};
        features.forEach(feature => {
          userInput[feature] = parseInt(document.getElementById(feature).value);
        });
        
        // Call the API
        const response = await fetch('/api/recommend', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(userInput)
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
          displayRecommendations(data.recommendations);
          updateProgress(100);
        } else {
          throw new Error(data.message || 'Failed to get recommendations');
        }
      } catch (error) {
        console.error('Error getting recommendations:', error);
        alert('Failed to get recommendations. Please try again.');
        resetForm();
      } finally {
        document.getElementById('loading').style.display = 'none';
      }
    }
    
    // Display recommendations
    function displayRecommendations(recommendations) {
      const container = document.getElementById('recommendations');
      if (!container) return;
      
      container.innerHTML = '';
      
      if (!recommendations || recommendations.length === 0) {
        container.innerHTML = '<div class="col-12"><p class="text-center">No recommendations found. Please try adjusting your ratings.</p></div>';
        return;
      }
      
      // Create cards for each recommendation
      recommendations.forEach((item) => {
        const card = document.createElement('div');
        card.className = 'col-md-6 col-lg-4';
        
        // Ensure career_options is an array
        const careerOptions = Array.isArray(item.career_options) ? 
          item.career_options : 
          String(item.career_options || '').split(',').map(s => s.trim()).filter(Boolean);
          
        // Ensure top_skills is an array
        const topSkills = Array.isArray(item.top_skills) ? 
          item.top_skills : 
          [];
        
        card.innerHTML = `
          <div class="course-card h-100">
            <h4 class="mb-3">${item.course || 'N/A'}</h4>
            <div class="progress mb-3" style="height: 10px;">
              <div class="progress-bar bg-success" role="progressbar" 
                   style="width: ${(item.similarity || 0) * 100}%" 
                   aria-valuenow="${(item.similarity || 0) * 100}" 
                   aria-valuemin="0" 
                   aria-valuemax="100">
              </div>
            </div>
            <p class="mb-2"><strong>Match:</strong> ${Math.round((item.similarity || 0) * 100)}%</p>
            
            <div class="mb-3">
              <strong>Top Skills:</strong>
              <div class="mt-1">
                ${topSkills.map(skill => `<span class="badge bg-primary me-1 mb-1">${skill}</span>`).join('')}
              </div>
            </div>
            
            <div>
              <strong>Career Options:</strong>
              <ul class="mt-1 mb-0">
                ${careerOptions.map(career => `<li>${career}</li>`).join('')}
              </ul>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
      
      // Show results and create chart
      const resultsSection = document.getElementById('results');
      if (resultsSection) {
        resultsSection.style.display = 'block';
        createChart(recommendations);
      }
    }
    
    // Create chart for recommendations
    function createChart(recommendations) {
      const chartElement = document.getElementById('chart');
      if (!chartElement) {
        console.error('Chart element not found');
        return;
      }
      
      const ctx = chartElement.getContext('2d');
      
      // Destroy previous chart if it exists
      if (window.commerceChart) {
        window.commerceChart.destroy();
      }
      
      if (typeof Chart === 'undefined') {
        console.error('Chart.js is not loaded');
        return;
      }
      
      window.commerceChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: recommendations.map(r => r.course),
          datasets: [{
            label: 'Similarity Score',
            data: recommendations.map(r => r.similarity),
            backgroundColor: 'rgba(52, 152, 219, 0.7)',
            borderColor: 'rgba(52, 152, 219, 1)',
            borderWidth: 1,
            borderRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              max: 1,
              title: {
                display: true,
                text: 'Similarity Score'
              },
              ticks: {
                callback: function(value) {
                  return (value * 100) + '%';
                }
              }
            },
            x: {
              title: {
                display: true,
                text: 'Recommended Courses'
              }
            }
          },
          plugins: {
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `Match: ${(context.raw * 100).toFixed(1)}%`;
                }
              }
            },
            legend: {
              display: false
            }
          }
        }
      });
    }
    
    // Update progress bar
    function updateProgress(percent) {
      const progressBar = document.getElementById('progressBar');
      if (progressBar) {
        progressBar.style.width = percent + '%';
        progressBar.setAttribute('aria-valuenow', percent);
      }
    }
    
    // Reset the form
    function resetForm() {
      document.getElementById('step1').style.display = 'block';
      document.getElementById('results').style.display = 'none';
      document.getElementById('recommendations').innerHTML = '';
      updateProgress(33);
      
      // Reset all sliders to 50
      document.querySelectorAll('.form-range').forEach(slider => {
        slider.value = 50;
        const valueSpan = document.getElementById(`${slider.id}-value`);
        if (valueSpan) {
          valueSpan.textContent = '50%';
        }
      });
      
      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  </script>
  </div>
</body>
</html>
